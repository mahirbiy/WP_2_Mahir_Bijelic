<div class="trackers-page">
  <div class="header-info">
    <h1>Welcome, {{ trenutniKorisnik }}</h1>
    <div class="analytics-pill glass-effect">
      <svg viewBox="0 0 36 36" class="circular-chart">
        <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
        <path class="circle" [attr.stroke-dasharray]="procentiZavrseno + ', 100'"
          d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
        <text x="18" y="20.35" class="percentage">{{ procentiZavrseno }}%</text>
      </svg>
      <div class="ai-text">
        <small>DNEVNI FOKUS</small>
        <p>"{{ aiPoruka }}"</p>
      </div>
    </div>
  </div>

  <div class="tracker-grid">
    @for (item of podaci | keyvalue; track item.key) {
      <div class="card" (click)="otvoriProzor(item.key)" [class.locked-card]="item.value.isLocked">
        <span class="icon">{{ item.value.ikona }}</span>
        <h3>{{ item.value.naslov }}</h3>
        <p class="badge">{{ item.value.isLocked ? 'Spremljeno' : 'Uredi' }}</p>
      </div>
    }
  </div>

  @if (aktivniTrackerKey) {
    <div class="overlay" (click)="zatvoriProzor()">
      <div class="modal glass-modal" (click)="$event.stopPropagation()">
        <button class="close-btn" (click)="zatvoriProzor()">×</button>
        <div class="modal-header">
          <span class="modal-icon">{{ podaci[aktivniTrackerKey].ikona }}</span>
          <h2>{{ podaci[aktivniTrackerKey].naslov }}</h2>
        </div>

        <div class="modal-body">
          @if (!podaci[aktivniTrackerKey].isLocked) {
            <div [ngSwitch]="aktivniTrackerKey">
              
              <div *ngSwitchCase="'fitness'">
                <label>Aktivnost:</label>
                <input type="text" [(ngModel)]="podaci.fitness.aktivnost" class="modal-input">
                <div class="row-inputs">
                  <input type="number" [(ngModel)]="podaci.fitness.trajanje" class="modal-input" placeholder="Minuta">
                  <select [(ngModel)]="podaci.fitness.intenzitet" class="modal-input">
                    <option value="Nizak">Nizak</option><option value="Srednji">Srednji</option><option value="Visok">Visok</option>
                  </select>
                </div>
              </div>

              <div *ngSwitchCase="'water'">
                <label>Broj čaša:</label>
                <input type="number" [(ngModel)]="podaci.water.vrijednost" class="modal-input">
                <label>Vrsta pića:</label>
                <select [(ngModel)]="podaci.water.vrstaPica" class="modal-input">
                  <option value="Voda">Voda </option><option value="Čaj">Čaj</option><option value="Kafa">Kafa</option>
                </select>
              </div>

              <div *ngSwitchCase="'sleep'">
                <label>Sati sna:</label>
                <input type="number" [(ngModel)]="podaci.sleep.sati" class="modal-input">
                <div class="row-inputs">
                  <select [(ngModel)]="podaci.sleep.kvalitet" class="modal-input">
                    <option value="Dobro">Dobro</option><option value="Umoran">Umoran</option><option value="Odlično">Sjajno</option>
                  </select>
                  <input type="time" [(ngModel)]="podaci.sleep.vrijemeBudjenja" class="modal-input">
                </div>
              </div>

              <div *ngSwitchCase="'finance'">
                <label>Iznos (KM):</label>
                <input type="number" [(ngModel)]="podaci.finance.iznos" class="modal-input">
                <label>Opis troška:</label>
                <input type="text" [(ngModel)]="podaci.finance.opis" class="modal-input" placeholder="npr. Kupovina užine">
              </div>

              <div *ngSwitchCase="'mood'">
                <label>Raspoloženje:</label>
                <select [(ngModel)]="podaci.mood.status" class="modal-input">
                  <option value="Sretan">Sretan</option><option value="Neutralno">Neutralno</option><option value="Umoran">Umoran</option>
                </select>
                <label>Šta je uticalo na tebe?</label>
                <textarea [(ngModel)]="podaci.mood.napomena" class="modal-input"></textarea>
              </div>

              <div *ngSwitchCase="'habit'">
                <label>Navika:</label>
                <input type="text" [(ngModel)]="podaci.habit.nazivNavike" class="modal-input">
                <div class="row-inputs">
                  <input type="time" [(ngModel)]="podaci.habit.vrijeme" class="modal-input">
                  <select [(ngModel)]="podaci.habit.kategorija" class="modal-input">
                    <option value="Zdravlje">Zdravlje</option><option value="Učenje">Učenje</option>
                  </select>
                </div>
                <div class="streak-box">Niz dana: {{ podaci.habit.serijaDana }}</div>
              </div>

            </div>
            <button class="btn-save" (click)="sacuvaj()">Save & Lock</button>
          } @else {
            <div class="locked-view">
              <p>Podaci su zaključani za danas.</p>
              <button class="btn-edit" (click)="otkljucaj()">Unlock</button>
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>